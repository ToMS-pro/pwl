<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contoh Tabel dengan Input Manual</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 12px;
            text-align: center;
        }
        th {
            background-color: #007BFF; /* Warna biru untuk header */
            color: white;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        .naik {
            background-color: #d4edda; /* Warna hijau untuk kolom Naik */
        }
        .turun {
            background-color: #f8d7da; /* Warna merah muda untuk kolom Turun */
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #ddd;
        }
        .header {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #007BFF; /* Warna biru untuk header di atas */
            color: white;
            border-radius: 5px;
        }
        .header span {
            display: inline-block;
            margin-right: 10px;
        }
        input[type="text"], input[type="number"], input[type="date"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box; /* Menjaga ukuran input sesuai kontainer */
        }
        input[type="text"]:focus, input[type="number"]:focus, input[type="date"]:focus {
            border-color: #007BFF; /* Warna border saat fokus */
            outline: none; /* Menghilangkan outline default */
        }
        @media (max-width: 600px) {
            table, th, td {
                font-size: 14px; /* Mengubah ukuran font pada perangkat kecil */
            }
            .header span {
                display: block; /* Menampilkan header secara vertikal */
                margin-bottom: 5px; /* Jarak antar elemen */
            }
        }
    </style>
</head>
<body>

    <div class="header">
        <span><strong>KA</strong>: <input type="text" id="ka_input" placeholder="Masukkan KA"></span>
        <span><strong>Rute</strong>: <input type="text" id="rute_input" placeholder="Masukkan Rute"></span>
        <span><strong>Tgl</strong>: <input type="date" id="tanggal_input"></span>
        <span><strong>Format Tgl</strong>: <span id="formatted_date"></span></span>
        <span><strong>Nama</strong>: <input type="text" id="nama_input" placeholder="Masukkan Nama"></span>
    </div>

    <table>
        <thead>
            <tr>
                <th rowspan="2">NO</th>
                <th rowspan="2">NAMA STASIUN</th>
                <th colspan="2">NAIK</th>
                <th colspan="2">TURUN</th>
            </tr>
            <tr>
                <th>Kg</th>
                <th>Koli</th>
                <th>Kg</th>
                <th>Koli</th>
            </tr>
        </thead>
        <tbody>
            <script>
                for (let i = 1; i <= 30; i++) {
                    document.write(`\
                        <tr>
                            <td>${i}</td>
                            <td><input type="text" id="stasiun${i}" placeholder="Masukkan Nama Stasiun"></td>
                            <td class="naik"><input type="number" id="naikKg${i}" value=""></td>
                            <td class="naik"><input type="number" id="naikKoli${i}" value=""></td>
                            <td class="turun"><input type="number" id="turunKg${i}" value=""></td>
                            <td class="turun"><input type="number" id="turunKoli${i}" value=""></td>
                        </tr>
                    `);
                }
            </script>
            <tr>
                <td>Total</td>
                <td></td>
                <td id="totalNaikKg"></td>
                <td id="totalNaikKoli"></td>
                <td id="totalTurunKg"></td>
                <td id="totalTurunKoli"></td>
            </tr>
        </tbody>
    </table>

    <button onclick="downloadExcel()">Unduh sebagai Excel</button>
    <button onclick="showWhatsAppInstructions()">Kirim ke WhatsApp</button>

    <script>
        function updateTotals() {
            let totalNaikKg = 0;
            let totalNaikKoli = 0;
            let totalTurunKg = 0;
            let totalTurunKoli = 0;

            for (let i = 1; i <= 39; i++) {
                totalNaikKg += parseFloat(document.getElementById(`naikKg${i}`).value) || 0;
                totalNaikKoli += parseFloat(document.getElementById(`naikKoli${i}`).value) || 0;
                totalTurunKg += parseFloat(document.getElementById(`turunKg${i}`).value) || 0;
                totalTurunKoli += parseFloat(document.getElementById(`turunKoli${i}`).value) || 0;
            }

            const hasilKg = totalNaikKg - totalTurunKg;
            const hasilKoli = totalNaikKoli - totalTurunKoli;

            document.getElementById('totalNaikKg').textContent = hasilKg;
            document.getElementById('totalNaikKoli').textContent = hasilKoli;
            document.getElementById('totalTurunKg').textContent = totalTurunKg;
            document.getElementById('totalTurunKoli').textContent = totalTurunKoli;

            // Simpan total ke localStorage
            localStorage.setItem('totalNaikKg', hasilKg);
            localStorage.setItem('totalNaikKoli', hasilKoli);
            localStorage.setItem('totalTurunKg', totalTurunKg);
            localStorage.setItem('totalTurunKoli', totalTurunKoli);
        }

        const inputs = document.querySelectorAll('input[type="number"], input[type="text"]');
        inputs.forEach(input => {
            // Setiap kali input berubah, simpan nilainya ke localStorage
            input.addEventListener('input', function() {
                localStorage.setItem(this.id, this.value);
                updateTotals();
            });
        });

        // Mengambil data dari localStorage saat halaman dimuat
        window.onload = function() {
            inputs.forEach(input => {
                const savedValue = localStorage.getItem(input.id);
                if (savedValue) {
                    input.value = savedValue;
                }
            });

            document.getElementById('totalNaikKg').textContent = localStorage.getItem('totalNaikKg') || 0;
            document.getElementById('totalNaikKoli').textContent = localStorage.getItem('totalNaikKoli') || 0;
            document.getElementById('totalTurunKg').textContent = localStorage.getItem('totalTurunKg') || 0;
            document.getElementById('totalTurunKoli').textContent = localStorage.getItem('totalTurunKoli') || 0;
        };

        document.getElementById('tanggal_input').addEventListener('change', function() {
            const inputDate = this.value;
            if (inputDate) {
                const dateParts = inputDate.split('-');
                const formattedDate = `${dateParts[2]}-${dateParts[1]}-${dateParts[0]}`;
                document.getElementById('formatted_date').textContent = formattedDate;
                localStorage.setItem('tanggal_input', inputDate);
                localStorage.setItem('formatted_date', formattedDate);
            }
        });

        window.onload = function() {
            const inputs = document.querySelectorAll('input[type="number"], input[type="text"], input[type="date"]');
            inputs.forEach(input => {
                const savedValue = localStorage.getItem(input.id);
                if (savedValue) {
                    input.value = savedValue;
                }
            });

            document.getElementById('formatted_date').textContent = localStorage.getItem('formatted_date') || '';

            document.getElementById('totalNaikKg').textContent = localStorage.getItem('totalNaikKg') || 0;
            document.getElementById('totalNaikKoli').textContent = localStorage.getItem('totalNaikKoli') || 0;
            document.getElementById('totalTurunKg').textContent = localStorage.getItem('totalTurunKg') || 0;
            document.getElementById('totalTurunKoli').textContent = localStorage.getItem('totalTurunKoli') || 0;
        };

        function downloadExcel() {
            const wb = XLSX.utils.book_new();
            const ws_data = [];
            ws_data.push(["NO", "NAMA STASIUN", "NAIK Kg", "NAIK Koli", "TURUN Kg", "TURUN Koli"]);

            for (let i = 1; i <= 39; i++) {
                const stasiun = document.getElementById(`stasiun${i}`).value || "";
                const naikKg = document.getElementById(`naikKg${i}`).value || "";
                const naikKoli = document.getElementById(`naikKoli${i}`).value || "";
                const turunKg = document.getElementById(`turunKg${i}`).value || "";
                const turunKoli = document.getElementById(`turunKoli${i}`).value || "";

                ws_data.push([i, stasiun, naikKg, naikKoli, turunKg, turunKoli]);
            }

            // Menambahkan baris total
            const totalNaikKg = document.getElementById('totalNaikKg').textContent || 0;
            const totalNaikKoli = document.getElementById('totalNaikKoli').textContent || 0;
            const totalTurunKg = document.getElementById('totalTurunKg').textContent || 0;
            const totalTurunKoli = document.getElementById('totalTurunKoli').textContent || 0;

            ws_data.push(["Total", "", totalNaikKg, totalNaikKoli, totalTurunKg, totalTurunKoli]);

            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            XLSX.utils.book_append_sheet(wb, ws, "Data");

            const ka = document.getElementById('ka_input').value || 'KA';
            const rute = document.getElementById('rute_input').value || 'Rute';
            const tanggal = document.getElementById('tanggal_input').value;
            const formattedTanggal = tanggal ? tanggal.split('-').reverse().join('-') : 'Tanggal'; // Format tanggal
            const namaTas = document.getElementById('nama_input').value || 'NamaTas'; // Nama tas

            const fileName = `${ka}_${rute}_${formattedTanggal}_${namaTas}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        function showWhatsAppInstructions() {
            const ka = document.getElementById('ka_input').value || 'KA';
            const rute = document.getElementById('rute_input').value || 'Rute';
            const tanggal = document.getElementById('tanggal_input').value;
            const formattedTanggal = tanggal ? tanggal.split('-').reverse().join('-') : 'Tanggal'; // Format tanggal
            const namaTas = document.getElementById('nama_input').value || 'NamaTas'; // Nama tas

            const message = `KA: ${ka}\nRute: ${rute}\nTanggal: ${formattedTanggal}\nNama: ${namaTas}`;
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }
    </script>

</body>
</html>
